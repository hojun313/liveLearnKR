<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•œêµ­ ìƒí™œ ì–´íœ˜ ë§ˆìŠ¤í„°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@0.292.0/dist/umd/lucide.min.js"></script>
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            overscroll-behavior-y: contain; /* Prevent pull-to-refresh on mobile */
        }
        .category-card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .category-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .phrase-card {
            transition: background-color 0.2s ease-in-out;
        }
        .phrase-card:hover {
            background-color: #f0f9ff; /* Tailwind's sky-50 */
        }
        /* Custom scrollbar for phrase list */
        #phraseList::-webkit-scrollbar {
            width: 8px;
        }
        #phraseList::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        #phraseList::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        #phraseList::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        .modal-content {
            display: flex;
            flex-direction: column;
            max-height: 85vh; /* ëª¨ë‹¬ ì „ì²´ì˜ ìµœëŒ€ ë†’ì´ ì•½ê°„ ëŠ˜ë¦¼ */
        }

        #phraseList {
            overflow-y: auto; 
            flex-grow: 1; 
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        .animate-fadeIn {
            animation: fadeIn 0.3s ease-out forwards;
        }

        /* ë¡œë”© ìŠ¤í”¼ë„ˆ ìŠ¤íƒ€ì¼ */
        .loader {
            border: 4px solid #f3f3f3; /* Light grey */
            border-top: 4px solid #3498db; /* Blue */
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            display: inline-block;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .gemini-button {
            background-color: #8A2BE2; /* ë³´ë¼ìƒ‰ ê³„ì—´ */
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.875rem;
            transition: background-color 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        .gemini-button:hover {
            background-color: #7B1FA2;
        }
        .example-sentence-container {
            margin-top: 10px;
            padding: 10px;
            background-color: #e9d5ff; /* ì—°í•œ ë³´ë¼ìƒ‰ ë°°ê²½ */
            border-radius: 8px;
            border-left: 4px solid #8A2BE2;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-sky-100 to-indigo-200 min-h-screen flex flex-col items-center justify-center p-4 selection:bg-sky-300 selection:text-sky-900">

    <div class="w-full max-w-3xl mx-auto bg-white rounded-xl shadow-2xl overflow-hidden flex flex-col" style="max-height: 95vh;">
        <header class="bg-sky-600 text-white p-6 shadow-md">
            <h1 class="text-3xl font-bold text-center">ğŸ‡°ğŸ‡· í•œêµ­ ìƒí™œ ì–´íœ˜ ë§ˆìŠ¤í„° ğŸ—£ï¸</h1>
            <p class="text-center text-sky-100 mt-1">ì‹¤ìƒí™œì— ìœ ìš©í•œ í•œêµ­ì–´ í‘œí˜„ì„ ë°°ì›Œë³´ì„¸ìš”!</p>
        </header>

        <main class="p-6 flex-grow overflow-y-auto">
            <section id="dailyTipSection" class="mb-8 p-5 bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 rounded-lg shadow">
                <div class="flex justify-between items-center mb-2">
                    <h2 class="text-xl font-semibold">ğŸŒŸ ì˜¤ëŠ˜ì˜ ê¿€íŒ!</h2>
                    <button id="newTipButton" class="text-sm bg-yellow-500 hover:bg-yellow-600 text-white py-1 px-3 rounded-md transition-colors flex items-center">
                        <i data-lucide="refresh-cw" class="w-4 h-4 mr-1"></i>ìƒˆ ê¿€íŒ ë³´ê¸°
                    </button>
                </div>
                <p id="dailyTipText" class="text-sm min-h-[40px]">ê¿€íŒì„ ìƒì„± ì¤‘ì…ë‹ˆë‹¤...</p> 
            </section>

            <section id="categorySelection">
                <h2 class="text-2xl font-semibold mb-6 text-gray-800">ì¹´í…Œê³ ë¦¬ ì„ íƒ</h2>
                <div id="categoryGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                    </div>
            </section>

            <div id="phraseModal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50 hidden">
                <div class="bg-white rounded-lg shadow-xl w-full max-w-lg modal-content animate-fadeIn">
                    <div class="flex justify-between items-center p-5 border-b border-gray-200 sticky top-0 bg-white z-10">
                        <h3 id="modalTitle" class="text-2xl font-semibold text-sky-700">ì¹´í…Œê³ ë¦¬ ì´ë¦„</h3>
                        <button id="closeModalButton" class="text-gray-500 hover:text-red-600 transition-colors p-2 rounded-full hover:bg-red-100">
                            <i data-lucide="x" class="w-7 h-7"></i>
                        </button>
                    </div>
                    <div id="phraseList" class="p-5 space-y-3">
                        </div>
                     <div class="p-4 border-t border-gray-200 text-center sticky bottom-0 bg-white z-10">
                        <p class="text-xs text-gray-500">ìŠ¤í”¼ì»¤ ì•„ì´ì½˜ì„ í´ë¦­í•˜ë©´ ë°œìŒì„ ë“¤ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                    </div>
                </div>
            </div>
        </main>

        <footer class="bg-gray-800 text-white text-center p-4">
            <p class="text-sm">&copy; <span id="currentYear"></span> í•œêµ­ ìƒí™œ ì–´íœ˜ ë§ˆìŠ¤í„°. Gemini API ì ìš©.</p>
        </footer>
    </div>

    <script>
        // --- Data ---
        const categories = [
            // ê¸°ì¡´ ì¹´í…Œê³ ë¦¬ ë°ì´í„° ìœ ì§€
            {
                id: "greetings",
                name: "ğŸ‘‹ ì¸ì‚¬ (Greetings)",
                emoji: "ğŸ‘‹",
                phrases: [
                    { kor: "ì•ˆë…•í•˜ì„¸ìš”", rom: "annyeonghaseyo", eng: "Hello / Hi / Good morning / Good afternoon / Good evening" },
                    { kor: "ê°ì‚¬í•©ë‹ˆë‹¤", rom: "gamsahamnida", eng: "Thank you (formal)" },
                    { kor: "ê³ ë§™ìŠµë‹ˆë‹¤", rom: "gomapseumnida", eng: "Thank you (formal, slightly softer)" },
                    { kor: "ê³ ë§ˆì›Œìš”", rom: "gomawoyo", eng: "Thank you (polite)" },
                    { kor: "ê³ ë§ˆì›Œ", rom: "gomawo", eng: "Thanks (informal)" },
                    { kor: "ì£„ì†¡í•©ë‹ˆë‹¤", rom: "joesonghamnida", eng: "I am sorry (formal)" },
                    { kor: "ë¯¸ì•ˆí•©ë‹ˆë‹¤", rom: "mianhamnida", eng: "I am sorry (formal, slightly softer)" },
                    { kor: "ë¯¸ì•ˆí•´ìš”", rom: "mianhaeyo", eng: "Sorry (polite)" },
                    { kor: "ë¯¸ì•ˆí•´", rom: "mianhae", eng: "Sorry (informal)" },
                    { kor: "ë„¤", rom: "ne", eng: "Yes / I agree / Okay / What? (when called)" },
                    { kor: "ì•„ë‹ˆìš”", rom: "aniyo", eng: "No" },
                    { kor: "ê´œì°®ì•„ìš”", rom: "gwaenchanayo", eng: "It's okay / I'm okay / No, thank you" },
                    { kor: "ë§Œë‚˜ì„œ ë°˜ê°‘ìŠµë‹ˆë‹¤", rom: "mannaseo bangapseumnida", eng: "Nice to meet you" },
                    { kor: "ì²˜ìŒ ëµ™ê² ìŠµë‹ˆë‹¤", rom: "cheoeum boepgetseumnida", eng: "Nice to meet you for the first time (more formal)" },
                    { kor: "ì•ˆë…•íˆ ê°€ì„¸ìš”", rom: "annyeonghi gaseyo", eng: "Goodbye (to someone leaving, you are staying)" },
                    { kor: "ì•ˆë…•íˆ ê³„ì„¸ìš”", rom: "annyeonghi gyeseyo", eng: "Goodbye (when you are leaving, they are staying)" },
                    { kor: "ì˜ ê°€ìš”", rom: "jal gayo", eng: "Goodbye (polite, to someone leaving)" },
                    { kor: "ì˜ ìˆì–´", rom: "jal isseo", eng: "Goodbye (informal, when you are leaving)" },
                    { kor: "ì—¬ë³´ì„¸ìš”?", rom: "yeoboseyo?", eng: "Hello? (on the phone)" },
                    { kor: "ì‹¤ë¡€í•©ë‹ˆë‹¤", rom: "sillyehamnida", eng: "Excuse me (to get attention, or pass by)" },
                ]
            },
            {
                id: "shopping",
                name: "ğŸ›ï¸ ì‡¼í•‘ (Shopping)",
                emoji: "ğŸ›ï¸",
                phrases: [
                    { kor: "ì´ê±° ì–¼ë§ˆì˜ˆìš”?", rom: "igeo eolmayeyo?", eng: "How much is this?" },
                    { kor: "ì €ê±° ì–¼ë§ˆì˜ˆìš”?", rom: "jeogeo eolmayeyo?", eng: "How much is that?" },
                    { kor: "ë„ˆë¬´ ë¹„ì‹¸ìš”", rom: "neomu bissayo", eng: "It's too expensive." },
                    { kor: "ì¢€ ê¹ì•„ì£¼ì„¸ìš”", rom: "jom kkakkajuseyo", eng: "Please give me a little discount." },
                    { kor: "ë´‰íˆ¬ í•„ìš”í•´ìš”", rom: "bongtu piryohaeyo", eng: "I need a bag." },
                    { kor: "ë´‰íˆ¬ ì£¼ì„¸ìš”", rom: "bongtu juseyo", eng: "Please give me a bag." },
                    { kor: "ì¹´ë“œ ë¼ìš”?", rom: "kadeu dwaeyo?", eng: "Do you accept credit cards?" },
                    { kor: "í˜„ê¸ˆìœ¼ë¡œ í• ê²Œìš”", rom: "hyeongeumeuro halgeyo", eng: "I'll pay in cash." },
                    { kor: "ì˜ìˆ˜ì¦ ì£¼ì„¸ìš”", rom: "yeongsujeung juseyo", eng: "Please give me a receipt." },
                    { kor: "ì´ê±° ì…ì–´ë´ë„ ë¼ìš”?", rom: "igeo ibeobwado dwaeyo?", eng: "Can I try this on? (clothes)" },
                    { kor: "íƒˆì˜ì‹¤ ì–´ë””ì˜ˆìš”?", rom: "taruisil eodiyeyo?", eng: "Where is the fitting room?" },
                    { kor: "ë‹¤ë¥¸ ìƒ‰ê¹” ìˆì–´ìš”?", rom: "dareun saekkkal isseoyo?", eng: "Do you have this in another color?" },
                    { kor: "ë” í° ì‚¬ì´ì¦ˆ ìˆì–´ìš”?", rom: "deo keun saijeu isseoyo?", eng: "Do you have a bigger size?" },
                    { kor: "ë” ì‘ì€ ì‚¬ì´ì¦ˆ ìˆì–´ìš”?", rom: "deo jageun saijeu isseoyo?", eng: "Do you have a smaller size?" },
                    { kor: "ì´ê±¸ë¡œ ì£¼ì„¸ìš”", rom: "igeollo juseyo", eng: "I'll take this one." },
                ]
            },
            {
                id: "restaurant",
                name: "ğŸœ ì‹ë‹¹ (Restaurant)",
                emoji: "ğŸœ",
                phrases: [
                    { kor: "ë©”ë‰´ ì£¼ì„¸ìš”", rom: "menyu juseyo", eng: "Please give me the menu." },
                    { kor: "ë¬¼ ì¢€ ì£¼ì„¸ìš”", rom: "mul jom juseyo", eng: "Please give me some water." },
                    { kor: "ì´ê±° ì£¼ì„¸ìš”", rom: "igeo juseyo", eng: "Please give me this (pointing at menu)." },
                    { kor: "ì €ê¸°ìš”!", rom: "jeogiyo!", eng: "Excuse me! (to call staff)" },
                    { kor: "ì£¼ë¬¸í• ê²Œìš”", rom: "jumunhalgeyo", eng: "I'd like to order." },
                    { kor: "ì´ê±° í•˜ë‚˜ ì£¼ì„¸ìš”", rom: "igeo hana juseyo", eng: "Please give me one of this." },
                    { kor: "ì´ê±° ë‘ ê°œ ì£¼ì„¸ìš”", rom: "igeo du gae juseyo", eng: "Please give me two of this." },
                    { kor: "í™”ì¥ì‹¤ ì–´ë””ì˜ˆìš”?", rom: "hwajangsil eodiyeyo?", eng: "Where is the restroom?" },
                    { kor: "ì˜ ë¨¹ê² ìŠµë‹ˆë‹¤", rom: "jal meokgetseumnida", eng: "I will eat well (before eating)." },
                    { kor: "ì˜ ë¨¹ì—ˆìŠµë‹ˆë‹¤", rom: "jal meogeotseumnida", eng: "I ate well (after eating)." },
                    { kor: "ê³„ì‚°ì„œ ì£¼ì„¸ìš”", rom: "gyesanseo juseyo", eng: "Please give me the bill." },
                    { kor: "ê³„ì‚°í•´ì£¼ì„¸ìš”", rom: "gyesanhaejuseyo", eng: "Please calculate (check out)." },
                    { kor: "ë”°ë¡œ ê³„ì‚°í• ê²Œìš”", rom: "ttaro gyesanhalgeyo", eng: "We'll pay separately." },
                    { kor: "ê°™ì´ ê³„ì‚°í• ê²Œìš”", rom: "gachi gyesanhalgeyo", eng: "We'll pay together." },
                    { kor: "í¬ì¥í•´ì£¼ì„¸ìš”", rom: "pojanghaejuseyo", eng: "Please make it to-go / wrap it up." },
                    { kor: "ëœ ë§µê²Œ í•´ì£¼ì„¸ìš”", rom: "deol maepge haejuseyo", eng: "Please make it less spicy." },
                    { kor: "ì•ˆ ë§µê²Œ í•´ì£¼ì„¸ìš”", rom: "an maepge haejuseyo", eng: "Please make it not spicy." },
                ]
            },
            {
                id: "transportation",
                name: "ğŸšŒ êµí†µ (Transportation)",
                emoji: "ğŸšŒ",
                phrases: [
                    { kor: "ì—¬ê¸° ì–´ë””ì˜ˆìš”?", rom: "yeogi eodiyeyo?", eng: "Where is here?" },
                    { kor: "ì´ ë²„ìŠ¤ ì–´ë”” ê°€ìš”?", rom: "i beoseu eodi gayo?", eng: "Where does this bus go?" },
                    { kor: "ì´ ì§€í•˜ì²  ì–´ë”” ê°€ìš”?", rom: "i jihacheol eodi gayo?", eng: "Where does this subway go?" },
                    { kor: "ê°€ì¥ ê°€ê¹Œìš´ ì§€í•˜ì² ì—­ì´ ì–´ë””ì˜ˆìš”?", rom: "gajang gakkaun jihacheollyeogi eodiyeyo?", eng: "Where is the nearest subway station?" },
                    { kor: "ê°€ì¥ ê°€ê¹Œìš´ ë²„ìŠ¤ ì •ë¥˜ì¥ì´ ì–´ë””ì˜ˆìš”?", rom: "gajang gakkaun beoseu jeongnyujangi eodiyeyo?", eng: "Where is the nearest bus stop?" },
                    { kor: "í‘œ ì–´ë””ì„œ ì‚¬ìš”?", rom: "pyo eodiseo sayo?", eng: "Where can I buy a ticket?" },
                    { kor: "êµí†µì¹´ë“œ ì¶©ì „í•´ì£¼ì„¸ìš”", rom: "gyotongkadeu chungjeonhaejuseyo", eng: "Please charge my transportation card." },
                    { kor: "ë‹¤ìŒ ì •ë¥˜ì¥ì—ì„œ ë‚´ë ¤ì£¼ì„¸ìš”", rom: "daeum jeongnyujangeseo naeryeojuseyo", eng: "Please let me off at the next stop." },
                    { kor: "ì—¬ê¸°ì„œ ë‚´ë ¤ì£¼ì„¸ìš”", rom: "yeogiseo naeryeojuseyo", eng: "Please let me off here." },
                    { kor: "íƒì‹œ ë¶ˆëŸ¬ì£¼ì„¸ìš”", rom: "taeksi bulleojuseyo", eng: "Please call a taxi for me." },
                    { kor: "[ì¥ì†Œ]ì— ê°€ì£¼ì„¸ìš”", rom: "[jangso]e gajuseyo", eng: "Please take me to [place]." },
                    { kor: "ì–¼ë§ˆë‚˜ ê±¸ë ¤ìš”?", rom: "eolmana geollyeoyo?", eng: "How long does it take?" },
                ]
            },
            {
                id: "numbers",
                name: "ğŸ”¢ ê¸°ë³¸ ìˆ«ì (Basic Numbers)",
                emoji: "ğŸ”¢",
                phrases: [
                    { kor: "ì˜ (ê³µ)", rom: "yeong (gong)", eng: "Zero" },
                    { kor: "ì¼ (í•˜ë‚˜)", rom: "il (hana)", eng: "One (Sino-Korean / Native Korean)" },
                    { kor: "ì´ (ë‘˜)", rom: "i (dul)", eng: "Two" },
                    { kor: "ì‚¼ (ì…‹)", rom: "sam (set)", eng: "Three" },
                    { kor: "ì‚¬ (ë„·)", rom: "sa (net)", eng: "Four" },
                    { kor: "ì˜¤ (ë‹¤ì„¯)", rom: "o (daseot)", eng: "Five" },
                    { kor: "ìœ¡ (ì—¬ì„¯)", rom: "yuk (yeoseot)", eng: "Six" },
                    { kor: "ì¹  (ì¼ê³±)", rom: "chil (ilgop)", eng: "Seven" },
                    { kor: "íŒ” (ì—¬ëŸ)", rom: "pal (yeodeol)", eng: "Eight" },
                    { kor: "êµ¬ (ì•„í™‰)", rom: "gu (ahop)", eng: "Nine" },
                    { kor: "ì‹­ (ì—´)", rom: "sip (yeol)", eng: "Ten" },
                    { kor: "ë°±", rom: "baek", eng: "Hundred" },
                    { kor: "ì²œ", rom: "cheon", eng: "Thousand" },
                    { kor: "ë§Œ", rom: "man", eng: "Ten Thousand" },
                ]
            },
            {
                id: "days_time",
                name: "ğŸ“… ìš”ì¼ & ì‹œê°„ (Days & Time)",
                emoji: "ğŸ“…",
                phrases: [
                    { kor: "ì˜¤ëŠ˜", rom: "oneul", eng: "Today" },
                    { kor: "ì–´ì œ", rom: "eoje", eng: "Yesterday" },
                    { kor: "ë‚´ì¼", rom: "naeil", eng: "Tomorrow" },
                    { kor: "ì›”ìš”ì¼", rom: "woryoil", eng: "Monday" },
                    { kor: "í™”ìš”ì¼", rom: "hwayoil", eng: "Tuesday" },
                    { kor: "ìˆ˜ìš”ì¼", rom: "suyoil", eng: "Wednesday" },
                    { kor: "ëª©ìš”ì¼", rom: "mogyoil", eng: "Thursday" },
                    { kor: "ê¸ˆìš”ì¼", rom: "geumyoil", eng: "Friday" },
                    { kor: "í† ìš”ì¼", rom: "toyoil", eng: "Saturday" },
                    { kor: "ì¼ìš”ì¼", rom: "iryoil", eng: "Sunday" },
                    { kor: "ì§€ê¸ˆ ëª‡ ì‹œì˜ˆìš”?", rom: "jigeum myeot siyeyo?", eng: "What time is it now?" },
                    { kor: "ì•„ì¹¨", rom: "achim", eng: "Morning" },
                    { kor: "ì ì‹¬", rom: "jeomsim", eng: "Lunchtime / Afternoon" },
                    { kor: "ì €ë…", rom: "jeonyeok", eng: "Evening / Dinner time" },
                    { kor: "ë°¤", rom: "bam", eng: "Night" },
                ]
            }
        ];

        // --- DOM Elements ---
        const categoryGrid = document.getElementById('categoryGrid');
        const phraseModal = document.getElementById('phraseModal');
        const modalTitle = document.getElementById('modalTitle');
        const phraseList = document.getElementById('phraseList');
        const closeModalButton = document.getElementById('closeModalButton');
        const dailyTipText = document.getElementById('dailyTipText');
        const currentYearSpan = document.getElementById('currentYear');
        const newTipButton = document.getElementById('newTipButton');

        // Gemini API Configuration
        const API_KEY = ""; // ì¤‘ìš”: ì‹¤ì œ ì‚¬ìš© ì‹œ ì—¬ê¸°ì— API í‚¤ë¥¼ ì…ë ¥í•˜ê±°ë‚˜, í™˜ê²½ ë³€ìˆ˜ì—ì„œ ë¡œë“œí•˜ì„¸ìš”. Canvas í™˜ê²½ì—ì„œëŠ” ë¹„ì›Œë‘ë©´ ìë™ìœ¼ë¡œ ì œê³µë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        const GEMINI_API_URL_GENERATE_CONTENT = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${API_KEY}`;

        // --- Functions ---

        // Function to speak text
        function speak(text, lang = 'ko-KR') {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = lang;
                utterance.rate = 0.9; 
                window.speechSynthesis.speak(utterance);
            } else {
                showCustomAlert("ìŒì„± ì¬ìƒì„ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.");
            }
        }
        
        // Custom Alert Function
        function showCustomAlert(message, type = 'error') {
            const alertBox = document.createElement('div');
            alertBox.style.position = 'fixed';
            alertBox.style.left = '50%';
            alertBox.style.top = '20px';
            alertBox.style.transform = 'translateX(-50%)';
            alertBox.style.padding = '10px 20px';
            if (type === 'success') {
                alertBox.style.backgroundColor = '#d4edda';
                alertBox.style.color = '#155724';
                alertBox.style.border = '1px solid #c3e6cb';
            } else { // error or default
                alertBox.style.backgroundColor = '#f8d7da'; 
                alertBox.style.color = '#721c24';
                alertBox.style.border = '1px solid #f5c6cb';
            }
            alertBox.style.borderRadius = '5px';
            alertBox.style.zIndex = '1000';
            alertBox.style.boxShadow = '0 2px 10px rgba(0,0,0,0.1)';
            alertBox.textContent = message;
            document.body.appendChild(alertBox);
            setTimeout(() => {
                alertBox.remove();
            }, 3000);
        }

        // Populate categories
        function populateCategories() {
            categoryGrid.innerHTML = ''; 
            categories.forEach(category => {
                const card = document.createElement('div');
                card.className = 'category-card bg-sky-500 hover:bg-sky-600 text-white p-6 rounded-xl shadow-lg cursor-pointer flex flex-col items-center justify-center text-center';
                card.innerHTML = `
                    <span class="text-4xl mb-3">${category.emoji || 'ğŸ“–'}</span>
                    <h3 class="text-xl font-semibold">${category.name}</h3>
                `;
                card.addEventListener('click', () => openPhraseModal(category));
                categoryGrid.appendChild(card);
            });
        }

        // Open phrase modal
        function openPhraseModal(category) {
            modalTitle.textContent = category.name;
            phraseList.innerHTML = ''; 

            category.phrases.forEach(phrase => {
                const phraseCard = document.createElement('div');
                phraseCard.className = 'phrase-card bg-gray-50 p-4 rounded-lg shadow-sm border border-gray-200';
                
                phraseCard.innerHTML = `
                    <div class="flex justify-between items-center mb-2">
                        <h4 class="text-lg font-semibold text-sky-700">${phrase.kor}</h4>
                        <button class="speak-button text-sky-500 hover:text-sky-700 p-1 rounded-full hover:bg-sky-100" data-text="${phrase.kor}" title="ë°œìŒ ë“£ê¸°">
                            <i data-lucide="volume-2" class="w-6 h-6"></i>
                        </button>
                    </div>
                    <p class="text-sm text-gray-600"><strong>ë°œìŒ:</strong> ${phrase.rom}</p>
                    <p class="text-sm text-gray-500"><strong>English:</strong> ${phrase.eng}</p>
                    <div class="mt-3">
                        <button class="generate-example-button gemini-button" data-phrase-kor="${phrase.kor}">
                            âœ¨ ì˜ˆë¬¸ ìƒì„±
                        </button>
                        <div class="example-sentences-placeholder mt-2"></div>
                        <div class="loading-spinner-placeholder mt-2" style="display: none;"><div class="loader"></div> <span class="text-sm text-gray-500 ml-2">ì˜ˆë¬¸ ìƒì„± ì¤‘...</span></div>
                    </div>
                `;
                phraseList.appendChild(phraseCard);
            });
            
            phraseList.querySelectorAll('.speak-button').forEach(button => {
                button.addEventListener('click', (e) => {
                    e.stopPropagation(); 
                    const textToSpeak = button.dataset.text;
                    speak(textToSpeak);
                });
            });

            phraseList.querySelectorAll('.generate-example-button').forEach(button => {
                button.addEventListener('click', async (e) => {
                    const koreanPhrase = e.target.dataset.phraseKor;
                    const placeholder = e.target.closest('.phrase-card').querySelector('.example-sentences-placeholder');
                    const spinnerPlaceholder = e.target.closest('.phrase-card').querySelector('.loading-spinner-placeholder');
                    
                    // ì´ì „ ì˜ˆë¬¸ê³¼ ë²„íŠ¼ ìˆ¨ê¸°ê¸° (ìƒˆë¡œ ìƒì„± ì‹œ)
                    placeholder.innerHTML = '';
                    e.target.style.display = 'none'; // "ì˜ˆë¬¸ ìƒì„±" ë²„íŠ¼ ìˆ¨ê¸°ê¸°
                    spinnerPlaceholder.style.display = 'flex'; // ë¡œë”© ìŠ¤í”¼ë„ˆ ë³´ì´ê¸°

                    try {
                        const examples = await fetchExampleSentences(koreanPhrase);
                        if (examples && examples.length > 0) {
                            const examplesHtml = examples.map((ex, index) => `
                                <div class="example-sentence-container">
                                    <p class="text-sm"><strong>ì˜ˆë¬¸ ${index + 1}:</strong> ${ex.kor}</p>
                                    <p class="text-xs text-gray-600"><em>(Eng: ${ex.eng})</em></p>
                                </div>
                            `).join('');
                            placeholder.innerHTML = examplesHtml + '<button class="close-examples-button mt-2 text-xs text-red-500 hover:text-red-700">ì˜ˆë¬¸ ë‹«ê¸°</button>';
                            
                            placeholder.querySelector('.close-examples-button').addEventListener('click', () => {
                                placeholder.innerHTML = '';
                                e.target.style.display = 'inline-flex'; // "ì˜ˆë¬¸ ìƒì„±" ë²„íŠ¼ ë‹¤ì‹œ ë³´ì´ê¸°
                            });

                        } else {
                            placeholder.innerHTML = '<p class="text-sm text-red-500">ì˜ˆë¬¸ ìƒì„±ì— ì‹¤íŒ¨í–ˆê±°ë‚˜ ì˜ˆë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                             e.target.style.display = 'inline-flex'; // ì‹¤íŒ¨ ì‹œ ë²„íŠ¼ ë‹¤ì‹œ ë³´ì´ê¸°
                        }
                    } catch (error) {
                        console.error("Error fetching example sentences:", error);
                        showCustomAlert("ì˜ˆë¬¸ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                        placeholder.innerHTML = '<p class="text-sm text-red-500">ì˜ˆë¬¸ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>';
                        e.target.style.display = 'inline-flex'; // ì˜¤ë¥˜ ì‹œ ë²„íŠ¼ ë‹¤ì‹œ ë³´ì´ê¸°
                    } finally {
                        spinnerPlaceholder.style.display = 'none'; // ë¡œë”© ìŠ¤í”¼ë„ˆ ìˆ¨ê¸°ê¸°
                    }
                });
            });

            if (typeof lucide !== 'undefined') {
                lucide.createIcons(); 
            } else {
                console.error("Lucide library not loaded when trying to create icons in modal.");
                showCustomAlert("ì•„ì´ì½˜ì„ í‘œì‹œí•˜ëŠ” ë° ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
            }
            phraseModal.classList.remove('hidden');
            document.body.style.overflow = 'hidden'; 
        }

        // Close phrase modal
        function closePhraseModal() {
            phraseModal.classList.add('hidden');
            document.body.style.overflow = 'auto'; 
        }
        
        // Set current year in footer
        function setCurrentYear() {
            const currentYearSpan = document.getElementById('currentYear');
            if (currentYearSpan) {
                currentYearSpan.textContent = new Date().getFullYear();
            }
        }

        // --- Gemini API Functions ---
        async function generateTextFromGemini(prompt) {
            // Gemini API í˜¸ì¶œ (í…ìŠ¤íŠ¸ ìƒì„±ìš©)
            let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
            const payload = { contents: chatHistory };

            try {
                const response = await fetch(GEMINI_API_URL_GENERATE_CONTENT, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!response.ok) {
                    const errorBody = await response.text();
                    console.error("Gemini API Error HTTP Status:", response.status, errorBody);
                    throw new Error(`Gemini API request failed with status ${response.status}`);
                }
                const result = await response.json();
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    return result.candidates[0].content.parts[0].text;
                } else {
                    console.error("Unexpected response structure from Gemini API:", result);
                    throw new Error("Gemini APIê°€ ìœ íš¨í•œ ì‘ë‹µì„ ë°˜í™˜í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
                }
            } catch (error) {
                console.error("Error calling Gemini API:", error);
                throw error; // ì—ëŸ¬ë¥¼ ë‹¤ì‹œ ë˜ì ¸ì„œ í˜¸ì¶œí•œ ìª½ì—ì„œ ì²˜ë¦¬í•˜ë„ë¡ í•¨
            }
        }

        async function fetchDailyTip() {
            // ì˜¤ëŠ˜ì˜ ê¿€íŒ ìƒì„± í•¨ìˆ˜
            dailyTipText.innerHTML = '<div class="loader" style="width:16px; height:16px; border-top-color: #f59e0b;"></div> <span class="ml-2 text-sm">ìƒˆë¡œìš´ ê¿€íŒì„ ìƒì„± ì¤‘ì…ë‹ˆë‹¤...</span>';
            newTipButton.disabled = true;
            try {
                const prompt = "í•œêµ­ ìƒí™œì´ë‚˜ í•œêµ­ì–´ í•™ìŠµì— ëŒ€í•œ ì§§ê³  ìœ ìš©í•œ íŒì„ í•œ ë¬¸ì¥ìœ¼ë¡œ ì•Œë ¤ì£¼ì„¸ìš”. ë„ˆë¬´ ê¸¸ì§€ ì•Šê²Œ, í•œë‘ ì¤„ë¡œ ìš”ì•½í•´ì£¼ì„¸ìš”.";
                const tip = await generateTextFromGemini(prompt);
                dailyTipText.textContent = tip || "ìƒˆë¡œìš´ ê¿€íŒì„ ê°€ì ¸ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.";
            } catch (error) {
                dailyTipText.textContent = "ê¿€íŒ ë¡œë”© ì‹¤íŒ¨! ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.";
                showCustomAlert("ì˜¤ëŠ˜ì˜ ê¿€íŒì„ ê°€ì ¸ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
            } finally {
                newTipButton.disabled = false;
                 if (typeof lucide !== 'undefined') { // ì•„ì´ì½˜ ì¬ë Œë”ë§
                    lucide.createIcons();
                }
            }
        }

        async function fetchExampleSentences(koreanPhrase) {
            // ì„ íƒëœ í‘œí˜„ì— ëŒ€í•œ ì˜ˆë¬¸ ìƒì„± í•¨ìˆ˜ (JSON í˜•ì‹ ì‘ë‹µ ê¸°ëŒ€)
            const prompt = `"${koreanPhrase}"ë¼ëŠ” í•œêµ­ì–´ í‘œí˜„ì„ ì‚¬ìš©í•œ ì‹¤ìƒí™œ ì˜ˆë¬¸ 2ê°œë¥¼ ë§Œë“¤ì–´ì£¼ì„¸ìš”. ê° ì˜ˆë¬¸ì€ í•œêµ­ì–´(kor)ì™€ ì˜ì–´ ë²ˆì—­(eng)ì„ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤. ë°˜ë“œì‹œ JSON í˜•ì‹ìœ¼ë¡œë§Œ ì‘ë‹µí•´ì£¼ì„¸ìš”. ì˜ˆì‹œ í˜•ì‹: [{"kor": "ì²« ë²ˆì§¸ í•œêµ­ì–´ ì˜ˆë¬¸ì…ë‹ˆë‹¤.", "eng": "This is the first Korean example sentence."}, {"kor": "ë‘ ë²ˆì§¸ í•œêµ­ì–´ ì˜ˆë¬¸ì…ë‹ˆë‹¤.", "eng": "This is the second Korean example sentence."}]`;
            
            const payload = {
                contents: [{ role: "user", parts: [{ text: prompt }] }],
                generationConfig: {
                    responseMimeType: "application/json",
                    responseSchema: {
                        type: "ARRAY",
                        items: {
                            type: "OBJECT",
                            properties: {
                                "kor": { "type": "STRING", description: "í•œêµ­ì–´ ì˜ˆë¬¸" },
                                "eng": { "type": "STRING", description: "ì˜ì–´ ë²ˆì—­" }
                            },
                            required: ["kor", "eng"]
                        }
                    }
                }
            };

            try {
                const response = await fetch(GEMINI_API_URL_GENERATE_CONTENT, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!response.ok) {
                    const errorBody = await response.text();
                    console.error("Gemini API Error (Examples) HTTP Status:", response.status, errorBody);
                    throw new Error(`Gemini API (Examples) request failed with status ${response.status}`);
                }
                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    // API ì‘ë‹µì—ì„œ í…ìŠ¤íŠ¸ ë¶€ë¶„ì„ ê°€ì ¸ì™€ JSONìœ¼ë¡œ íŒŒì‹±
                    const jsonText = result.candidates[0].content.parts[0].text;
                    return JSON.parse(jsonText); 
                } else {
                     console.error("Unexpected response structure from Gemini API (Examples):", result);
                    // ì‘ë‹µì— 'text' í•„ë“œê°€ ì—†ëŠ” ê²½ìš°, Gemini APIê°€ ìŠ¤í‚¤ë§ˆì— ë§ì§€ ì•ŠëŠ” ì‘ë‹µì„ í–ˆì„ ìˆ˜ ìˆìŒ
                    if (result.promptFeedback && result.promptFeedback.blockReason) {
                         throw new Error(`Gemini APIê°€ ìš”ì²­ì„ ì°¨ë‹¨í–ˆìŠµë‹ˆë‹¤: ${result.promptFeedback.blockReason}`);
                    }
                    throw new Error("Gemini API (Examples)ê°€ ìœ íš¨í•œ JSON ì‘ë‹µì„ ë°˜í™˜í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
                }
            } catch (error) {
                console.error("Error calling Gemini API for examples:", error);
                throw error;
            }
        }


        // --- Event Listeners ---
        closeModalButton.addEventListener('click', closePhraseModal);
        phraseModal.addEventListener('click', (event) => {
            if (event.target === phraseModal) { 
                closePhraseModal();
            }
        });
        document.addEventListener('keydown', (event) => {
            if (event.key === 'Escape' && !phraseModal.classList.contains('hidden')) {
                closePhraseModal();
            }
        });
        newTipButton.addEventListener('click', fetchDailyTip);


        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            populateCategories();
            fetchDailyTip(); // í˜ì´ì§€ ë¡œë“œ ì‹œ ì˜¤ëŠ˜ì˜ ê¿€íŒ ê°€ì ¸ì˜¤ê¸°
            setCurrentYear();
            
            if (typeof lucide !== 'undefined') {
                lucide.createIcons(); 
            } else {
                console.error("Lucide library not loaded on DOMContentLoaded.");
                showCustomAlert("ì•„ì´ì½˜ì„ í‘œì‹œí•˜ëŠ” ë° ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨ í•´ë³´ì„¸ìš”.");
            }
            
            if (!('speechSynthesis' in window)) {
                 showCustomAlert("ìŒì„± í•©ì„±ì„ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤. ì¼ë¶€ ê¸°ëŠ¥ì´ ì œí•œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
            }
        });

    </script>
</body>
</html>
